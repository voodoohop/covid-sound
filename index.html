<!DOCTYPE html>
<html>
<head>
<title></title>
<script src="https://unpkg.com/micromodal/dist/micromodal.min.js" type="text/javascript"> </script>
<style>

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/4.6.0/darkly/bootstrap.min.css" integrity="sha512-A/WvCV75maYUI3F3yjeSqYg0dUIepPRx14Qw8EZjJ/udG5/s3uDWLHnm1FSbYzrJg4RLdAdEm/f6+1V6AxCBJQ==" crossorigin="anonymous" />
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
</head>
<body style="background-image: url('covid_tibetan.png');background-color: black;  background-repeat: no-repeat;  background-attachment: fixed;
background-position: center; background-size: contain;">
<div id="modal" class="modal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Listen to COVID-19 deaths</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <p>
                For each new COVID-19 death a sample of the Tibetan <em><strong><a title="Kangling" href="https://en.wikipedia.org/wiki/Kangling">Kangling</a></strong></em>&nbsp;(<span class="uchen" lang="bo">རྐང་གླིང་།</span>) is played in real-time.
                The <em><strong><a title="Kangling" href="https://en.wikipedia.org/wiki/Kangling">Kangling</a></strong></em> is used in&nbsp;<a title="Tibetan Buddhism" href="https://en.wikipedia.org/wiki/Tibetan_Buddhism">Tibetan Buddhism</a>&nbsp;for various death rituals.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="startPlaying();">Start</button>
        </div>
      </div>
    </div>
  </div>
<script>
    $(document).ready(function() {
        $('#modal').modal('show');
    });
    function startPlaying() {
        const infectionsPerDay = 600000;
        const deathsPerDay = 16000;

        const infectionsPerSecond = infectionsPerDay / (60*60*24);
        const deathsPerSecond = deathsPerDay / (60*60*24);
        const numDeathSounds = 17;
        // console.log({infectionsPerSecond,deathsPerSecond});
        const deathSounds = new Array(numDeathSounds).fill(null).map((_,i) => new Audio(`death${i+1}.mp3`));
        const tapeSound = new Audio("tape.mp3");
        tapeSound.loop = true;
        tapeSound.play();
        
        const updateInterval = 100;
        
        setInterval(() => {
            // const infectionHappened = Math.random() < infectionsPerSecond * updateInterval/1000;
            const deathHappened = Math.random() < deathsPerSecond * updateInterval/1000;
            if (deathHappened) {
                console.log("death");
                deathSounds[Math.floor(Math.random()*deathSounds.length)].play();
            }
        }, updateInterval);
    };

</script>
</body>
</html>
